const app = document.getElementById("app");
const initialUrl = window.location.hash;
const router = new Navigo("/", {
  hash: true,
});

/*-------------------*/
/*------ Rutas ------*/
/*-------------------*/
router
  .on("/", showIndexPage)
  .on("/info", showInfoPage)
  .on("/video", showVideoPage)
  .on("/redes", showRedesPage)
  .on("/servicios", showServiciosPage)
  .on("/cierre", showCierrePage)
  .resolve(initialUrl || "/");

/*-------------------*/
/*------ Index ------*/
/*-------------------*/
function showIndexPage() {
  app.innerHTML = `
  <div class="slide slide-index">

    <div class="contenido-index">
      <img src="./images/muñeco-one.svg" alt="" class="contenido-index__muñeco">

      <ul class="texto">
        <li class="texto__bienvenida">Te damos la bienvenida a Vansa:</li>
        <li class="texto__prueba">Prueba técnica de:</li>
        <li class="texto__nombre">Oscar Botello</li>
        <li class="texto__vacante">Vacante Front End</li>
      </ul>

      <img src="./images/muñeca-one.svg" alt="" class="contenido-index__muñeca">
    </div>

    <div class="navegacion">
      <ul>
        <li>
          <a href="/info" data-navigo>
            <img src="./images/arrow-next.svg" alt="" class="arrow-next">
            Iniciar
          </a>
        </li>
      </ul>
    </div>

  </div>`;

  $(".navegacion a").addClass("inactivo");

  // Habilita el botón de iniciar después de 3 segundos
  setTimeout(function enableNextButton() {
    $(".navegacion a").removeClass("inactivo");
  }, 3000);
}

/*------------------*/
/*------ Info ------*/
/*------------------*/
function showInfoPage() {
  app.innerHTML = `
  <div class="slide slide-info">

    <div class="contenido-info">
      <img src="./images/muñeco-two.svg" alt="" class="contenido-info__muñeco">

      <div class="contenedor-info">
        <h2 class="contenedor-info__invitacion">¡Haz clic aquí!</h2>
        <img src="./images/img-polygon.svg" alt="" class="contenedor-info__polygon">
        <img src="./images/img-perfil.svg" alt="" class="contenedor-info__perfil">

        <button class="contenedor-info__btn-caja">
          <img src="./images/img-boton.svg" alt="" class="contenedor-info__boton">
        </button>
      </div>

    </div>

    <div class="navegacion">
      <ul>
        <li>
          <a href="/" data-navigo id="previous">
            <img src="./images/arrow-prev.svg" alt="" class="arrow-prev">
            Anterior
          </a>
        </li> 
        <li>
          <a href="/video" data-navigo class="inactivo">
            <img src="./images/arrow-next.svg" alt="" class="arrow-next">
            Siguiente
          </a>
        </li>   
      </ul>
    </div>

  </div>`;

  // Agregar evento de clic al botón contenedor-info__btn-caja
  $(".contenedor-info__btn-caja").on("click", function () {
    // Reproducir sonido de clic
    const audio = new Audio('../media/clic.mp3');
    audio.play();
    
    const paragraph = $(this).next(".description");

    if (paragraph.length) {
      paragraph.slideToggle();

      // Habilita el botón de siguiente luego de desplegar la información
      $(".navegacion a[href='/video']").removeClass("inactivo");
      $(".slide").addClass("activo");

    } else {
      const description = `
            <strong>Acerca de mí:</strong> Soy licenciado en Diseño Tecnológico, con conocimientos en  programación diseño y 
            desarrollo web Front-End, capacitado para traducir definiciones de diseño y resolver problemas de desarrollo web.`;
      const txtParagraph = $("<div><p class='paragraph'></p></div>").addClass("description").find("p").html(description).end();
      $(this).after(txtParagraph);
      $(".navegacion a[href='/video']").removeClass("inactivo");
      $(".slide").addClass("activo");
    }
  });

}

/*-------------------*/
/*------ Video ------*/
/*-------------------*/
function showVideoPage() {
  app.innerHTML = `
  <div class="slide slide-video">

    <div class="contenido-video">
      <h2 class="contenido-video__titulo">Veamos este video</h2>

      <div class="contenedor-video">
        <h3 class="contenedor-video__invita">¡Haz click en el botón!</h3>
        <img src="./images/img-polygon.svg" alt="" class="contenedor-video__polygon">

        <button id="btn-video" class="btn-video">
          <img src="./images/img-boton.svg" alt="" class="btn-video__img">
        </button>
      </div>

      <img src="./images/img-muñecos.svg" alt="" class="contenido-video__muñecos">
    </div>

    <div class="navegacion">
      <ul>
        <li>
          <a href="/info" data-navigo id="previous">
            <img src="./images/arrow-prev.svg" alt="" class="arrow-prev">
            Anterior
          </a>
        </li> 
        <li>
          <a href="/redes" data-navigo id="next" class="inactivo">
            <img src="./images/arrow-next.svg" alt="" class="arrow-next">
            Siguiente
          </a>
        </li>   
      </ul>
    </div>

  </div>`;

  $("#btn-video").click(function () {
    var popup = $("<div>").addClass("popup");
    $("body").append(popup);

    popup.css({
      background: "rgba(128, 128, 128, 1)",
      position: "fixed",
      top: "0",
      left: "0",
      width: "100%",
      height: "100%",
      zIndex: "9999"
    });

    // Crear video sin controles
    var video = $("<video>").attr({
      src: "../media/video1.mp4",
      autoplay: true
    }).css({
      position: "absolute",
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%)",
      width: "50%"
    });
    popup.append(video);

    // Crear botón de pausa
    var pauseButton = $("<img>").attr({
      src: "./images/btn-pausar.svg",
      alt: "Pausar"
    }).css({
      position: "absolute",
      bottom: "calc(-16rem + 50%)",
      left: "50%",
      transform: "translateX(-50%)",
      cursor: "pointer"
    });
    popup.append(pauseButton);

    // Crear audio para el clic del botón
    var clickSound = new Audio("../media/clic.mp3");

    // Pausar o reanudar el video al hacer clic en el botón de pausa
    pauseButton.on('click', function () {
      clickSound.play();

      if (video[0].paused) {
        video[0].play();
        pauseButton.attr("src", "./images/btn-pausar.svg");
      } else {
        video[0].pause();
        pauseButton.attr("src", "./images/btn-derecha.svg");
      }
    });

    video.on('pause', function () {
      pauseButton.attr("src", "./images/btn-derecha.svg");
    });

    video.on('play', function () {
      pauseButton.attr("src", "./images/btn-pausar.svg");
    });

    // Cerrar el popup al terminar el video
    video.on('ended', function () {
      popup.remove();
      $("#next").removeClass("inactivo");
    });
  });

}

/*-------------------*/
/*------ Redes ------*/
/*-------------------*/
function showRedesPage() {
  app.innerHTML = `
  <div class="slide slide-redes">

      <div class="contenido-redes">
        <img src="./images/muñeca-two.svg" alt="" class="contenido-redes__muñeca">

      <div class="contenedor-redes">
        <h2 class="contenedor-redes__titulo">Conoce más de vansa</h2>
        <h2 class="contenedor-redes__invitacion">¡Haz clic en cada item!</h2>
        <img src="./images/img-polygon.svg" alt="" class="contenedor-redes__polygon">
        <ul>
          <li class="boton-derecha">
            <button class="boton-derecha__derecha" data-url="https://www.vansa.co/">
              <img src="./images/icon-search.svg" alt="" class="boton-derecha__search">
              <img src="./images/btn-derecha.svg" alt="" class="boton-derecha__img">
            </button>
          </li>
          <li class ="boton-izquierda">
            <button class="btn-izquierda" data-url="https://co.linkedin.com/company/vansalatam">
              <img src="./images/btn-izquierda.svg" alt="" class="boton-izquierda__izquierda">
              <img src="./images/icon-linkedin.svg" alt="" class="boton-izquierda__linkedin">
            </button>
          </li>
          <li class="boton-derecha">
            <button class="boton-derecha__derecha" data-url="https://www.instagram.com/vansalatam/">
              <img src="./images/icon-instagram.svg" alt="" class="boton-derecha__instagram">
              <img src="./images/btn-derecha.svg" alt="" class="boton-derecha__img">
            </button>
          </li>
        </ul>
      </div>
    </div>

    <div class="navegacion">
      <ul>
        <li>
          <a href="/video" data-navigo id="previous">
            <img src="./images/arrow-prev.svg" alt="" class="arrow-prev">
            Anterior
          </a>
        </li> 
        <li>
          <a href="/servicios" data-navigo class="inactivo">
            <img src="./images/arrow-next.svg" alt="" class="arrow-next">
            Siguiente
          </a>
        </li>   
      </ul>
    </div>

  </div>`;

  // Habilita el botón de siguiente luego de ver todos los desplegables (3)

  $(".boton-derecha__derecha, .btn-izquierda").on("click", function () {
    // Reproducir sonido de clic
    const audio = new Audio('../media/clic.mp3');
    audio.play();
  
    const social = $(this).parent().find(".direccion");
    const url = $(this).data("url");
  
    if (social.length) {
      social.slideToggle();
    } else {
      const font_style = $(this).hasClass("boton-derecha__derecha") ? "semibold" : "regular";
      const txtSocial = `<div class="direccion" data-font-style="${font_style}"><p class='txt-redes'>${$(this).hasClass("boton-derecha__derecha") ? "Página web" : "LinkedIn"} <a href="${url}" class="ruta" target="_blank">${url}</a></p></div>`;
      $(this).parent().append(txtSocial);
    }
  
    // Habilitar el botón de siguiente después de ver todos los desplegables (3)
    const visibleDirections = $(".direccion:visible").length;
    if (visibleDirections === 3) {
      $(".navegacion a[href='/servicios']").removeClass("inactivo");
      $(".slide").addClass("activo");
    }
  });
  
  $(".slide").addClass("activo");
  
}

/*-----------------------*/
/*------ Servicios ------*/
/*-----------------------*/
function showServiciosPage() {
  app.innerHTML = `
  <div class="slide slide-servicios">

    <div class="contenido-servicios">
      <h2 class="contenido-servicios__titulo">Lo que hacemos</h2>

      <div class="contenedor-servicios">
        <h2 class="contenedor-servicios__invitacion">¡Haz clic las flechas!</h2>
        <img src="./images/img-polygon.svg" alt="" class="contenedor-servicios__polygon">

          <div class="slider">
            <div class="slider__cards">
              <div class="slider__card slider__card--uno"></div>
              <div class="slider__card slider__card--dos"></div>
              <div class="slider__card slider__card--tres"></div>
            </div>
            <div class="slider__arrows">
              <button class="slider__arrow slider__arrow--prev" title="Previous slide"></button>
              <button class="slider__arrow slider__arrow--next" title="Next slide"></button>
            </div>
            <div class="slider__bullets"></div>
          </div>

    </div>

    <div class="navegacion">
      <ul>
        <li>
          <a href="/redes" data-navigo id="previous">
            <img src="./images/arrow-prev.svg" alt="" class="arrow-prev">
            Anterior
          </a>
        </li> 
        <li>
          <a href="/cierre" data-navigo class="inactivo">
            <img src="./images/arrow-next.svg" alt="" class="arrow-next">
            Siguiente
          </a>
        </li>   
      </ul>
    </div>
  
  </div>`;

  // Al dar click en las flechas del carrusel debe sonar el efecto transition
  // Habilita el botón de siguiente luego de ver todos los slides del carrusel
  class Slider {
    constructor(sliderEl) {
      this.sliderEl = $(sliderEl);
      this.slides = this.sliderEl.find(".slider__card");
      this.slideCount = this.slides.length;
      this.bulletsContainer = this.sliderEl.find(".slider__bullets");
      this.arrows = {
        prev: this.sliderEl.find(".slider__arrow--prev"),
        next: this.sliderEl.find(".slider__arrow--next"),
      };
      this.bullets = [];
      this.activeIndex = 0;

      this._initializeSlider();
    }

    _initializeSlider() {
      this._createBullets();
      this._addBulletsToSlider();
      this._addEventListeners();

      this._updateUI();
    }

    _addEventListeners() {
      this.arrows.prev.on("click", this._onPrevArrowClick.bind(this));
      this.arrows.next.on("click", this._onNextArrowClick.bind(this));
    }

    // Reproduce el sonido al hacer clic en la flecha
    _onPrevArrowClick() {
      this._playArrowSound();
      this.activeIndex = this.activeIndex - 1;
      if (this.activeIndex < 0) {
        this.activeIndex = this.slideCount - 1;
      }

      this._updateUI();
    }

    _onNextArrowClick() {
      this._playArrowSound();
      this.activeIndex = (this.activeIndex + 1) % this.slideCount;
      this._updateUI();

      // Habilita el botón de siguiente si hemos llegado al último slide
      if (this.activeIndex === this.slideCount - 1) {
        this.arrows.next.attr("disabled", "disabled");
        $(".inactivo").removeClass("inactivo");
      } else {
        this.arrows.next.removeAttr("disabled");
        $(".inactivo").addClass("inactivo");
      }
    }

    _playArrowSound() {
      const audio = new Audio("../media/transition.mp3");
      audio.play();
    }

    _createBullets() {
      this.slides.each(() => {
        const bullet = $("<button>").addClass("slider__bullet");
        this.bullets.push(bullet);
      });
    }

    _addBulletsToSlider() {
      this.bullets.forEach((bullet) => {
        this.bulletsContainer.append(bullet);
      });
    }

    _updateUI() {
      this._updateActiveBullet();
      this._updateArrowsUI();
      this._updateSlidesUI();
    }

    _updateActiveBullet() {
      this.bullets.forEach((bullet, index) => {
        index === this.activeIndex
          ? bullet.attr("active", "")
          : bullet.removeAttr("active");
      });
    }

    _updateArrowsUI() {
      if (this.activeIndex === 0) {
        this.arrows.prev.attr("disabled", "disabled");
        this.arrows.next.removeAttr("disabled");
      } else if (this.activeIndex === this.slideCount - 1) {
        this.arrows.prev.removeAttr("disabled");
        this.arrows.next.attr("disabled", "disabled");
      } else {
        this.arrows.prev.removeAttr("disabled");
        this.arrows.next.removeAttr("disabled");
      }
    }

    _updateSlidesUI() {
      this.slides.each((index, slide) => {
        index === this.activeIndex
          ? $(slide).attr("active", "")
          : $(slide).removeAttr("active");
      });
    }
  }

  function init() {
    const slider = $(".slider");

    if (!slider.length) {
      console.warn("No se pudo obtener el elemento deslizante!");
      return;
    }

    new Slider(slider);
  }

  $(document).ready(init);

}

/*--------------------*/
/*------ Cierre ------*/
/*--------------------*/
function showCierrePage() {
  app.innerHTML = `
  <div class="slide slide-cierre">

    <div class="contenido-cierre">
      <img src="./images/muñecos-one.svg" alt="" class="contenido-cierre__muñecos">

      <div class="contenedor-cierre">
        <h2 class="contenedor-cierre__culminado">¡Hemos Culminado!</h2>
        <p class="contenedor-cierre__descripcion">
          Ahora que terminaste, cuéntanos por email 
          <span data-font-style="semibold">¿Cómo te sentiste en la prueba?</span>
        </p>
        <p class="contenedor-cierre__despedida"><span data-font-style="semibold">Hablamos pronto.</span></p>
      </div>
    </div>

    <div class="navegacion">
      <ul>
        <li>
          <a href="/" data-navigo id="previous">
            <img src="./images/arrow-prev.svg" alt="" class="arrow-prev">
            Reiniciar
          </a>
        </li> 
        <li>
          <a href="https://www.linkedin.com/in/otorres-38a6241a2/" data-navigo target="_blank" class="inactivo">
            <img src="./images/arrow-next.svg" alt="" class="arrow-next">
            Finalizar
          </a>
        </li>   
      </ul>
    </div>

  </div>`;

  // Habilita el botón de finalizar luego de 3 segundos
  setTimeout(function enableNextButton() {
    $(".navegacion a").removeClass("inactivo");
  }, 3000);

  $(".slide").addClass("activo");
}
